<source>
  @type forward
</source>

<match fluent.*>
  @type null
</match>

<filter docker.*>
  @type record_transformer
  renew_record true
  keep_keys service
  <record>
    message ${record["log"]}
    @type "#{ENV['HUMIO_PARSER']}"
    @container ${tag_parts[1]}
    @shipper ${hostname}
  </record>
</filter>

<filter **>
  @type stdout
</filter>

<match docker.*>
  @type copy
  <store>
    @type file
    path /var/log/fluent/docker
    flush_interval 10s
    format json
    append true
  </store>
  <store>
    @type elasticsearch
    host cloud.humio.com
    port 9200
    scheme https
    ssl_version TLSv1_2
    user "#{ENV['HUMIO_TOKEN']}"
    password ignore
    index_name docker2humio
    type_name docker2humio
    flush_interval 1s
  </store>
</match>